마림바의 시작. 그리고 아키텍처의 진화 과정

개인적으로 OOP, TDD 에서 중요하게 생각하는 것이 있다.
객체의 내부와 외부를 분리하는 것.
이를 통해 외부에는 일정한 품질의 인터페이스를 제공하고 내부를 자유롭게 구현하는 것이다.

이말은 곧, 객체 내부의 품질에 대해서 아무도 모르게 내가 결정하면 되는 것이다.
시간이 부족할 때는 값을 하드코딩 하거나, 일단 코드를 중복 해서 작성 할 수도 있다. 
물론 우리의 클린코드, 소프트웨어 장인정신에 위배 될 수는 있다.

현재, 스타트업의 초기 단계 이거나, 제품의 MVP를 만들고 있는 상황이라고 가정하자.
소프트웨어의 내부 품질을 높이느라고 시장에 제품을 내놓는 시기가 늦어지는 것이 과연 옳은 일 일까?

경제적 관점에서 봤을때,
소프트웨어의 사용자, 혹은 API를 사용하는 개발자 입장에서 동일한 기능에 대해서 굳이 더 비싼 비용을 지불하고 사용할 이유가 있을까?
내부 품질이 얼마나 멋진지 사용자는 알기 힘들다.
그렇다면 대부분 비용이 더 싼 제품을 선택하지 않을까?
내부 품질이 조금은 낮더라도 기능을 시장에서 하루라도 더 빨리 검증해 보는 것이 좋을 것 이다.

잠깐,
그렇다고 내부 품질이 엉망이어도 상관 없다는 말인가?
그토록 외치던 클린 코드, 클린 아키텍처가 다 필요 없다는 말인가?
그저 빨리 만들고 빨리 시장에 내놓는 것이 정답이라는 말인가?

개발자라면 모두가 알고 있다.
설계가 잘 되어 있지 않으면, 시간이 지나고 기능이 계속 추가 될 때마다, 복잡도가 올라간다.
동일 한 수준의 기능을 추가하는데 더 오래 걸리게 된다.

대부분 이를 레거시 코드라 부르고, 결국 언젠가 전체를 새로 개발하게 된다.

과거에 SI 프로젝트를 중심으로 일할 때, 회사에서 내세운 슬로건이 하나 있다.
“납기는 생명 품질은 자존심”
리소스는 한정되어 있고 할 일은 언제나 많고 기능이 자주 변경되는 상황에서 
납기는 반드시 지켜야 되지만, 잘 설계된 아키텍처와 코드를 만들어야 하고 버그도 없어야 한다는 말 이다.

가능한 말 일까?

완벽한 협업 하에 고정된 기능 목록에서 절대 변경되지 않고, 가치가 있는 기능인가와 별개로 정해진 기간에 고객에게 전달만 되면 되는 소프트웨어라면 가능 할 수는 있겠다. 

하지만 이렇게 완벽한 상황은 존재 하지 않는다.

우리는 사용자가 무엇을 원하는지 잘 알지 못하고, 언제나 상황은 변한다.

무엇이 사용자에게 가치가 있는지 없는지 모르는 상태에서 아키텍처를 고민하고 클린 코드를 작성하는 것이 낭비 일 수도 있다.
하지만 어느 순간에는 클린 코드, 클린 아키텍처가 없다면 기능 추가가 어렵고 작은 수정에도 side effect 가 발생하게 된다.

품질은 비용의 관점으로 바라 봤을때 언제나 trade off 이다.

내부 품질을 높이는거나 낮추는 것에 대해서,
누군가는 오버 엔지니어링 이라고 하고, 누군가는 기술 부채가 쌓여간다고 말을 한다.



이 것이 우리 팀이 처한 상황이 었다.

PM 2명, 디자이너 2명, 개발자 3명이 팀을 꾸렸다.

제약 사항으로는 온라인 화이트보드 면서 비디오콜 기능이 반드시 있어야 한다는 것이 었다.
코로나 전이라서 remote work 이 이슈가 되기도 전이었다.
우리는 remote work 에서 발생 할 수 있는 문제를 해결 하는 소프트웨어를 만들고 싶었다.
만들기만 하면 전 세계에서 수만명이 동시에 접속할 것 만 같았다.

request/response 가 아니라 실제로 커넥션을 맺고 stateful 한 server 환경을 구성해야 하는 것이었다. 전 세계에서 많은 사용자가 동시에 들어와야 하니까 분산환경이 었으면 좋겠고, 트래픽이 증가해도 잘 처리되면 좋을 것 같았다.

실제로 명확인 시나리오나 유스케이스가 없었고, 누구를 persona 로 정해야 할 지도 몰랐다. 있다고 하더라도 실제로 가치가 있는지 검증이 되지도 않았다.
우리는 MVP 이전의 완전 초기 단계였다. 
사용자가 누구인지 시장은 어떤지 어떤 기능이 가치가 있을 지 전혀 모르는 상황이 었다.
그저 제약사항으로 가지고  있는 기술적 이슈만 있을 뿐이 었다.
심지어 개발자는 3명 뿐이었다.


그래서 중요한 핵심가치를 정하고,
이를 기반으로 지속적으로 개선해 나가는 것이 중요하다.
문제는 절대로 없어지지 않는다. 조금씩 나아질 뿐이다.
단, 지속적으로 개선을 해 나간다면..


그 당시 비용의 문제로 낮은 내부 품질을 선택했다면,
조심할 것이 있다.
바로 관성.
앞으로도 낮은 품질을 선택해도 된다는 관성이 생기게 된다.
유리창이 깨져 있다면 지속적으로 관심을 가지고 수리해 나가야 된다.
그래야 전체가 망가는 것을 방지 할 수 있다.



